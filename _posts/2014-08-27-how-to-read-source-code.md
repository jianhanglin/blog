---
layout: post
title: 如何阅读软件源代码
---

读代码比写代码难得多，这是许多人的共识。然而，有时候需要阅读某些软件的源代码是必要的，这时就需要一些技巧了，以下是本人在阅读一些开源软件代码时的经验。

> 本人读的代码不多，而且主要集中于C/C++项目，因此下面内容仅是个人观点，可能存在一定偏颇。

### 书籍、文档、README、注释

如果有更好的资料，就不要直接一头扎进代码堆里。Linux内核代码量庞大，但是有许多书籍专门讲解其内部设计；许多开源软件都提供了详尽的架构技术文档，例如GDB调试器就提供了GDB Internals供开发者了解其实现方式。如果没有这样的资料，可以浏览代码中的README文件，这里一般写的是关于软件的介绍，但是也可能有编码上的说明，此外，还有代码中的描述性注释，这对理解代码也很有帮助。

总之，尽一切可能寻找可能对理解代码有帮助的资料，当然，也要保证资料中描述的软件代码版本与手头上的差异不大，否则过时的文档也没太大价值。

### 代码浏览工具

现在的软件代码多少都有些分量，不仅代码行数不少，而且代码之间的调用关系非常复杂，常常是文件A中使用了函数f，这个函数声明在文件B中，实现在文件C中。浏览这样逻辑复杂的代码，一个好用的工具是不可或缺的，一般来说，相应语言的IDE就能满足这项工作。利用IDE提供的“定位到声明”、“定位到实现”快捷键，可以实现方便地在代码间切换。

如果有更高的要求，也可以尝试阅读分析代码专用的软件，如Source Insight。

### 自顶向下的阅读顺序

阅读代码的顺序纯粹是一种个人口味问题，例如我习惯自顶向下的方式，首先搞清楚程序的大体逻辑、模块划分，然后分别阅读分析。这样做的好处就是逻辑比较清晰，如果只希望搞明白软件的某一个部分或功能是如何实现的，理清逻辑后也能很快找到。另一个好处就是，不必搞懂一个类、一个模块的所有细节。

### 根据命名推测

程序员写程序的时候，对变量、函数和类的名称通常都取一些有意义的字符串，根据名称往往就能推测出它的含义。此外命名规则也有助于理解，例如大写字母开头的是类型（这也取决于那种项目，比如Linux内核代码中就是以`_t`结尾的标识符代表类型），以`I`开头，后跟以大写字母开头的名称是接口名，小写字母开头的是变量，`m_`开头的是成员变量，如果使用的是匈牙利标记法，还可以看出变量对应的类型。

### 公有成员优先

如果某个类的定义包含数十个成员变量，数百个成员方法，这时不妨想一下，这个类定义的目的一定是供其他类使用，而共有的成员就是供其他类使用的API，根据这些共有的成员就可以分析出这个类的作用，而那些私有成员往往都是API实现的细节，完全可以暂时忽略。

### 做笔记

光用大脑是不够的，做一些笔记对理解程序代码逻辑很有帮助，自己写的代码时间长了都能看不懂，更别提别人的代码了。做笔记的方法也有很多，可以根据模块画出关系图，也可以根据类画出UML图，或者是文字描述。笔记的作用是让自己能看懂，越直观简洁越好。

### 邮件列表

最后，加入该软件开发者的邮件列表。这样，阅读源代码就不再是一个人的奋斗了，对于代码中的问题、建议，都可以在邮件列表中与全世界的开发者进行讨论。有不理解的地方，直接在邮件列表上发出来，其他人会非常热情地向你解释说明。
