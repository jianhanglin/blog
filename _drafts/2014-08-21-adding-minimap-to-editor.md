---
layout: post
title: 向文本编辑器添加缩略图滚动条
category: qt
---
Sublime Text有一个我很喜欢的功能，就是使用缩略图替代了传统的滚动条：

![](/assets/images/sublime.png)

这样的滚动条不仅用起来方便，而且看起来也很高端，本文就介绍如何在Qt中实现这样的滚动条。

### 文本编辑器

首先需要一个编辑器控件，才能用来测试我们的缩略图滚动条，这里采用`QPlainTextEdit`作为编辑器控件，因为它更适合编辑代码这类的纯文本。我对其进行了一些定制，调整了字体也添加了行号，具体实现方法可以参考Qt项目库中的[Code Editor](http://qt-project.org/doc/qt-4.8/widgets-codeeditor.html)示例。编辑器的效果如下图：

![](/assets/images/editor_1.png)

### 缩略图显示特点

如果仔细观察Sublime Text的缩略图，会发现缩略图的宽度与主体部分宽度的比例是个定值，缩放比例也是个定值。因此缩略图中显示的文本内容比主体部分长，但是宽度是一样的。将鼠标移到缩略图区域，会将当前可见部分高亮，如果文本缩略图的高度超过了窗口高度，那么将会以高亮部分（当前显示部分）位置设为所在文本的百分比对应处，其他部分根据高亮部分的位置相对确定。拖动高亮部分，还能够实现滚动的效果。

至此，任务已经清晰，首先需要获得编辑区的缩略图，其次通过合适的方式将缩略图显示出来，最后实现控制滚动功能，并替换默认的滚动条。

### 生成缩略图

`QPlainTextEdit`有一个document成员，可以通过这里使用`QPixmap`作为绘制设备

根据我的目测，Sublime Text生成缩略图使用了10:1的比例。
